# =============================================================================
# Default Task Runner configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Global Task Runner settings
# -----------------------------------------------------------------------------
runner:
  bin_dir: "./vendor/bin"

# -----------------------------------------------------------------------------
# Drupal-related settings.
# -----------------------------------------------------------------------------
#
# Value of "drupal.root_absolute" is derived at runtime.
# @see OpenEuropa\TaskRunner\Commands\DrupalCommands::setRuntimeConfig()
drupal:
  root: "web"
  root_absolute: ~
  base_url: "http://google.verbruggenlex"

  # Basic Drupal site information.
  site:
    name: "Representation in Portugal"
    mail: "info@example.org"
    profile: "multisite_drupal_standard"
    update: "false"
    locale: "en"
    sites_subdir: "default"

  # Administrator account information.
  account:
    name: "admin"
    password: "admin"
    mail: "admin@example.org"

  # Database settings.
  database:
    host: "mysql"
    port: "3306"
    name: "drupal"
    user: "user"
    password: "password"

  # Local Drush settings file will be generated by following default values.
  drush:
    options:
      uri: "${drupal.base_url}"

  # Following lines will be converted in PHP and appended to default.settings.php.
  settings: []

  # List of shell commands to be before and after the site installation.
  # You can use same syntax as the "commands:", check the documentation for more.
  # Configuration token replacement is supported too.
  pre_install:
  post_install:
    - "${runner.bin_dir}/run drupal:setup-development"

# -----------------------------------------------------------------------------
# GitHub configuration values.
# -----------------------------------------------------------------------------
github:
  # GitHub personal access token token.
  # @link https://github.com/settings/tokens
  token: ~

# -----------------------------------------------------------------------------
# Release commands configuration values.
# -----------------------------------------------------------------------------
release:

  # List of tasks to be ran before creating the release archive.
  tasks: []

  # Time and date formats used when generating values below.
  time_format: "H:i:s"
  date_format: "Y-m-d"

  # The following values are created at runtime and can be used when appending
  # release notes to text files.
  # They can be accessed via ${release.NAME}
# version: ~
# date: ~
# time: ~
# timestamp: ~

# -----------------------------------------------------------------------------
# List of dynamically-defined commands.
# -----------------------------------------------------------------------------
commands:
  drupal:site-clone:
    - "${runner.bin_dir}/drush -r ${drupal.root} settingsphp-generate --db-url=mysql://user:password@mysql:3306/drupal --skip-validation -y"
    - "while ! mysqladmin ping --user=user -h mysql --password=password --silent; do echo Waiting for mysql; sleep 3; done"
    - "${runner.bin_dir}/drush -r ${drupal.root} sql-create --target=default -y"
    - "${runner.bin_dir}/drush -r ${drupal.root}  sqlc --target=default < ./vendor/project/database/sanitized_daily_multisite_unitedkingdom_production.sql"
    - "${runner.bin_dir}/drush -r ${drupal.root} rr"
    - "${runner.bin_dir}/run drupal:setup-development"
  drupal:setup-development:
    - "${runner.bin_dir}/drush -r ${drupal.root} dis nexteuropa_varnish -y"
    - "${runner.bin_dir}/drush -r ${drupal.root} en stage_file_proxy devel maillog translation_helpers apachesolr reps_unitedkingdom_core -y"
    - "${runner.bin_dir}/drush -r ${drupal.root} eval \"variable_set('user_mail_status_activated_body', str_replace('[user:name]', '[user:name-raw]', _user_mail_text('status_activated_body', NULL, array(), FALSE)));\" -y"
    - "${runner.bin_dir}/drush -r ${drupal.root} eval \"variable_set('user_mail_register_admin_created_body', str_replace('[user:name]', '[user:name-raw]', _user_mail_text('register_admin_created_body', NULL, array(), FALSE)));\" -y"
    - "${runner.bin_dir}/drush -r ${drupal.root} eval \"variable_set('user_mail_register_no_approval_required_body', str_replace('[user:name]', '[user:name-raw]', _user_mail_text('register_no_approval_required_body', NULL, array(), FALSE)));\" -y"
    - "${runner.bin_dir}/drush -r ${drupal.root} vset nexteuropa_webtools_smartloader_prurl //ec.europa.eu/load.js"
    - "${runner.bin_dir}/drush -r ${drupal.root} vset stage_file_proxy_origin https://ec.europa.eu/unitedkingdom"
    - "${runner.bin_dir}/drush -r ${drupal.root} vset stage_file_proxy_origin_dir sites/unitedkingdom/files"
    - "${runner.bin_dir}/drush -r ${drupal.root} solr-set-env-url http://solr:8983/solr/d7_apachesolr"
    - "${runner.bin_dir}/drush -r ${drupal.root} vset stage_file_proxy_hotlink 1"
  drupal:setup-folders:
    - "mkdir -p ${drupal.root}/profiles/${drupal.site.profile}/libraries/mpdf/graph_cache && chmod -R 777 ${drupal.root}/profiles/${drupal.site.profile}/libraries/mpdf/graph_cache"
    - "mkdir -p ${PWD}/web/sites/all/modules/fpfis-sysadmin ${PWD}/web/sites/${drupal.site.sites_subdir}/modules/features/reps ${PWD}/web/sites/${drupal.site.sites_subdir}/modules/custom/reps ${PWD}/web/sites/${drupal.site.sites_subdir}/themes/custom/reps"
    - "mkdir -p ${drupal.root}/sites/${drupal.site.sites_subdir}/files/private_files && chmod -R 777 ${drupal.root}/sites/${drupal.site.sites_subdir}/files"
    - "ln -sf ${PWD}/vendor/ec-europa/ec-reps-platform/lib/modules/custom/*/ ${PWD}/web/sites/${drupal.site.sites_subdir}/modules/custom/reps"
    - "ln -sf ${PWD}/vendor/ec-europa/ec-reps-platform/lib/features/*/ ${PWD}/web/sites/${drupal.site.sites_subdir}/modules/features/reps"
    - "ln -sf ${PWD}/vendor/ec-europa/ec-reps-platform/lib/themes/*/ ${PWD}/web/sites/${drupal.site.sites_subdir}/themes/custom/reps"
    - "ln -sf ${PWD}/vendor/project/devops/sites/all/modules/fpfis/*/ ${PWD}/web/sites/all/modules/fpfis-sysadmin"
    - "ln -sf ${PWD}/lib/modules/features/*/ ${PWD}/web/sites/${drupal.site.sites_subdir}/modules/features"
    - "ln -sf $PWD/web/sites/${drupal.site.sites_subdir} $PWD/web/sites/unitedkingdom"